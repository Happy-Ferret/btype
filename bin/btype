#!/usr/bin/env node

var argv = require('minimist')(process.argv.slice(2));


function help() {
    console.log([
        'Usage:',
        '  btype <bt file path>'
    ].join('\n'));
}

if (process.argv.length < 3) {
    help();
    process.exit(1);
}

var fs = require('fs');
var path = require('path');


var compiler = require('../src/compiler/compiler');
var lexer = require('../src/lexer');
var parser = require('../src/parser');

fs.readFile(argv._[0], function(err, data) {
    if (err) {
        console.error('Could not read file.');
        console.error(err);
        help();
        process.exit(1);
    }

    var parsed = parser(lexer(data + ''));
    var compiled = compiler(
        path.basename(argv._[0], '.bt'),
        parsed,
        argv.target
    );

    console.log(compiled);

});
